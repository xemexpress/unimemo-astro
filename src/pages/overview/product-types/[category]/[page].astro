---
import type { GetStaticPathsOptions, Page } from "astro";
import { PRODUCT, UI } from "../../../../utils/constants";
import { getCollection } from "astro:content";
import {
    StringUtils,
    ProductUtils,
    SEOUtils,
} from "../../../../utils/coreUtils";
import ProductListView from "../../../../components/ProductListView.astro";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
    const productTypes = PRODUCT.ALL_TYPES;

    const allProducts = await getCollection("products");

    return productTypes.flatMap((productType) => {
        const filteredProducts = allProducts.filter(
            (product) =>
                ProductUtils.getProductTypeFromSku(product.data.sku) ===
                productType
        );

        return paginate(filteredProducts, {
            params: { category: productType },
            pageSize: UI.PRODUCTS_PER_PAGE,
        });
    });
}

type Props = {
    page: Page;
};

const { page } = Astro.props;
const { category } = Astro.params;
const title = StringUtils.capitalizeFirstLetter(category);
const seoDescription =
    SEOUtils.generateProductListCategoryDescription(category);
---

<ProductListView
    title={title}
    page={page}
    description={seoDescription}
    byCategory={true}
/>
